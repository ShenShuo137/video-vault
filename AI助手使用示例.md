# AI助手使用示例

## 🎯 AI助手功能说明

AI助手现在**已支持查询实际数据**！它可以从本地文件系统（本地模式）或数据库（云端模式）读取数据，并回答你的问题。

---

## 🔧 5个可用工具

### 1. query_audit_logs - 查询审计日志
**功能：** 查询视频中检测到的敏感信息记录

**示例问题：**
- "最近发现了哪些敏感信息？"
- "有检测到API密钥吗？"
- "查询包含password的审计日志"
- "某个视频ID的审计日志是什么？"

**返回内容：**
- 日志总数
- 详细的检测记录（最多20条）
- 汇总信息

---

### 2. get_video_status - 查询视频状态
**功能：** 查询指定视频的处理状态和敏感信息统计

**示例问题：**
- "视频xxx的状态是什么？"
- "这个视频检测到多少敏感信息？"
- "视频ID为xxx的详细信息"

**返回内容：**
- 视频基本信息（ID、标题、状态）
- 敏感信息总数
- 各类敏感信息的分类统计
- 状态描述

---

### 3. list_sensitive_videos - 列出高风险视频
**功能：** 列出包含大量敏感信息的高风险视频

**示例问题：**
- "有哪些高风险视频？"
- "哪些视频包含超过5个敏感信息？"
- "列出最危险的视频"
- "给我看看敏感信息最多的视频"

**返回内容：**
- 高风险视频总数
- 阈值设置
- 视频列表（按敏感信息数量排序）

---

### 4. extract_watermark - 水印溯源（预留功能）
**功能：** 从泄露的视频中提取水印，追溯下载者身份

**示例问题：**
- "这个视频是谁下载的？"
- "提取水印ID为xxx的信息"
- "追溯视频泄露者"

**当前状态：** 返回模拟数据，实际功能待实现

---

### 5. get_security_report - 生成安全报告
**功能：** 统计和分析最近的安全情况，生成综合报告

**示例问题：**
- "生成一份安全报告"
- "最近的安全情况怎么样？"
- "给我一份统计报告"
- "分析当前的安全风险"

**返回内容：**
- 统计周期
- 处理的视频总数
- 检测到的敏感信息总数
- 各类敏感信息分类统计
- 高风险视频数量和详情

---

## 💬 实际对话示例

### 示例1：查询审计日志

**你：** "最近发现了哪些敏感信息？"

**AI助手：**
```
我来查询一下最近的审计日志。

[调用工具: query_audit_logs]

根据审计日志，最近共检测到 15 次敏感信息暴露：

- openai_key: 3次
- password: 5次
- phone: 4次
- id_card: 3次

主要集中在test_video.mp4这个视频中。建议重点关注包含API密钥和密码的检测记录，这些属于高风险信息。
```

---

### 示例2：列出高风险视频

**你：** "有哪些高风险视频？"

**AI助手：**
```
让我查询一下高风险视频列表。

[调用工具: list_sensitive_videos]

当前共有 2 个高风险视频（敏感信息≥5个）：

1. test_video.mp4
   - 视频ID: abc-123-def
   - 敏感信息数量: 15个
   - 风险等级: 高

2. demo_video.mp4
   - 视频ID: xyz-456-uvw
   - 敏感信息数量: 8个
   - 风险等级: 中

建议：
- 对这些视频进行二次审查
- 确认脱敏处理是否完整
- 限制这些视频的分发范围
```

---

### 示例3：生成安全报告

**你：** "生成一份安全报告"

**AI助手：**
```
好的，我来为您生成安全报告。

[调用工具: get_security_report]

## Video Vault 安全报告

**统计周期：** 全部数据

### 总体情况
- 已处理视频：3个
- 检测到敏感信息：23次
- 高风险视频：2个

### 敏感信息分类
| 类型 | 数量 |
|------|------|
| password | 8次 |
| openai_key | 5次 |
| phone | 4次 |
| id_card | 3次 |
| email | 3次 |

### 高风险视频详情
1. test_video.mp4 - 15个敏感信息
2. demo_video.mp4 - 8个敏感信息

### 建议
1. 密码类信息检测较多，建议加强员工安全培训
2. API密钥泄露风险高，需要立即轮换相关密钥
3. 建议对高风险视频实施额外的访问控制
```

---

## 🎮 交互技巧

### 1. 明确的问题更有效

❌ **不好的问题：**
- "看看有什么问题"
- "检查一下"
- "帮我分析"

✅ **好的问题：**
- "列出所有高风险视频"
- "查询包含API密钥的审计日志"
- "生成最近7天的安全报告"

### 2. 可以追问和细化

```
你: "有哪些高风险视频？"
AI: [返回2个高风险视频]

你: "test_video.mp4的详细信息是什么？"
AI: [调用get_video_status查询详情]

你: "这个视频具体检测到了哪些敏感信息？"
AI: [调用query_audit_logs查询该视频的日志]
```

### 3. 结合上下文对话

AI助手会记住对话历史，可以进行连续对话：

```
你: "生成一份安全报告"
AI: [生成报告，显示有15个敏感信息]

你: "这15个敏感信息都是什么类型的？"
AI: [基于之前的查询结果回答]

你: "password类型的都在哪些视频里？"
AI: [调用工具进一步查询]
```

---

## 🐛 常见问题

### Q1: AI助手不调用工具，只是纯聊天？

**原因：**
- 问题表述不够明确
- 使用的模型不支持Function Calling
- API配置错误

**解决方法：**
1. 使用更明确的问题，比如"列出高风险视频"而不是"看看情况"
2. 使用支持Function Calling的模型：
   ```env
   LLM_MODEL=gpt-3.5-turbo-1106  # 推荐
   LLM_MODEL=gpt-4               # 更好
   ```
3. 检查后端日志，看是否有工具调用记录

---

### Q2: AI助手返回"error"或"视频不存在"？

**原因：**
- 还没有处理过任何视频
- 审计日志文件不存在
- 视频ID不正确

**解决方法：**
1. 先上传并处理一个视频
2. 检查 `backend/uploads/output/` 目录是否有数据
3. 使用正确的视频ID（从视频列表页面复制）

---

### Q3: AI助手响应很慢？

**原因：**
- 调用了多个工具
- API服务延迟
- 数据量较大

**解决方法：**
1. 耐心等待，工具调用需要时间
2. 如果超时，可以重新提问
3. 考虑使用更快的模型（gpt-3.5-turbo）

---

### Q4: 本地模式下AI助手能查询数据吗？

**答案：能！**

本地模式下，AI助手的工具会从 `backend/uploads/output/` 目录读取审计日志文件，完全可以查询实际数据。

---

## 🎯 最佳实践

1. **先处理视频，再咨询AI**
   - 上传几个测试视频
   - 等待处理完成
   - 然后问AI助手问题

2. **使用具体的问题**
   - 指定视频ID
   - 明确查询类型
   - 说明时间范围

3. **结合报告功能**
   - 定期生成安全报告
   - 追踪趋势变化
   - 导出重要信息

4. **利用对话记忆**
   - 进行连续对话
   - 深入追问细节
   - 需要时重置对话（"重置对话"按钮）

---

## 🚀 开始使用

1. **配置AI助手**
   - 编辑 `.env` 文件
   - 填入ChatAnywhere API Key
   - 重启后端服务

2. **处理测试视频**
   - 上传包含敏感信息的视频
   - 等待处理完成

3. **开始对话**
   - 进入"AI助手"页面
   - 输入问题
   - 查看AI的分析和建议

**祝使用愉快！** 🎉
